const NO_SHADOW={color:"transparent",blur:0},TWOPI=2*Math.PI;export default class RadialMenu{constructor({fontFamily:t,fontSize:i,innerCircle:e,outerCircle:s,rotation:o,shadowBlur:h,shadowColor:r,shadowOffsetX:n,shadowOffsetY:a,backgroundColor:l,hoverBackgroundColor:c,borderColor:d,textColor:u,hoverTextColor:f,textBorderColor:w,textShadowColor:C,textShadowBlur:b,textShadowOffsetX:x,textShadowOffsetY:v,buttonGap:S,buttons:g,hoverAction:y,posX:p,posY:O,isFixed:m,zIndex:B}={}){if(this.state={},this.state.hover=void 0,this.hoverAction=y||(()=>{}),this.scale=window.devicePixelRatio,this.fontFamily=t||"FontAwesome",this.fontSize=i||14,isNaN(this.fontSize))throw"Font size must be a number";if(this.innerCircle=isNaN(e)?50:e,this.outerCircle=isNaN(s)?100:s,this.innerCircle>this.outerCircle)throw"Inner circle can't be larger than outer circle";if(this.innerCircle<0)throw"Inner circle can't be negative";this.rotation=Math.abs(o%TWOPI)||0,this.shadowStyle={color:r||"rgba(0,0,0,0.5)",blur:isNaN(h)?10:h,offsetX:isNaN(n)?3:n,offsetY:isNaN(a)?3:a},this.backgroundColor=l||"#EEE",this.hoverBackgroundColor=c,this.borderColor=d||"#FFF",this.buttonGap=S||0,this.textColor=u||"#000",this.hoverTextColor=f,this.textBorderColor=w||"transparent",this.textShadowColor=C||"transparent",this.textShadowBlur=isNaN(b)?10:b,this.textShadowOffsetX=isNaN(x)?3:x,this.textShadowOffsetY=isNaN(v)?3:v,this.buttons=g||[{text:"",action:()=>{alert(1)}},{text:"",action:()=>{alert(2)}},{text:"",action:()=>{alert(3)}}],this.checkButtons(),this.posX=p||0,this.posY=O||0,this.isFixed=m||!1,this.zIndex=B||9999,this.canvas=document.createElement("canvas"),document.body.appendChild(this.canvas),this.init(),this.draw(),this.addEvent()}init(){this.step=TWOPI/this.buttons.length,this.w=2*this.outerCircle+2*this.shadowStyle.blur+2*this.shadowStyle.offsetX,this.h=2*this.outerCircle+2*this.shadowStyle.blur+2*this.shadowStyle.offsetY,this.canvas.style.display="none",this.canvas.style.position="fixed",this.canvas.style.width=this.w+"px",this.canvas.style.height=this.h+"px",this.canvas.width=this.w*this.scale,this.canvas.height=this.h*this.scale,this.c=this.canvas.getContext("2d"),this.c.scale(this.scale,this.scale),this.c.font=this.fontSize+"px "+this.fontFamily,this.canvas.style.zIndex=this.zIndex,this.w2=this.w>>1,this.h2=this.h>>1,this.backgroundColor instanceof Object&&(this.backgroundColor=this.createGradient(this.backgroundColor)),this.borderColor instanceof Object&&(this.borderColor=this.createGradient(this.borderColor)),this.shadowStyle.color instanceof Object&&(this.shadowStyle.color=this.createGradient(this.shadowStyle.color)),this.textColor instanceof Object&&(this.textColor=this.createGradient(this.textColor)),this.textBorderColor instanceof Object&&(this.textBorderColor=this.createGradient(this.textBorderColor)),this.textShadowColor instanceof Object&&(this.textShadowColor=this.createGradient(this.textShadowColor));const t=this.buttonGap,i=t*Math.PI*this.innerCircle/this.outerCircle;for(let e=0;e<this.buttons.length;e++){this.buttons[e].ini=(e*this.step+this.rotation+t)%TWOPI,this.buttons[e].fin=(this.buttons[e].ini+this.step-2*t)%TWOPI,this.buttons[e].ini_inner=(e*this.step+this.rotation+i)%TWOPI,this.buttons[e].fin_inner=(this.buttons[e].ini_inner+this.step-2*i)%TWOPI,this.buttons[e].ini>this.buttons[e].fin&&(this.rest=e);const s=this.buttons[e].ini+this.step/2-t;this.buttons[e].centerX=Math.cos(s)*(this.innerCircle+(this.outerCircle-this.innerCircle)/2)-this.fontSize/2,this.buttons[e].centerY=Math.sin(s)*(this.innerCircle+(this.outerCircle-this.innerCircle)/2)+this.fontSize/4}}draw(){const t=this.c;t.imageSmoothingEnabled=!0,t.imageSmoothingQuality="high",t.clearRect(0,0,this.w,this.h),this.buttonGap||(setContextShadowStyle(t,this.shadowStyle),t.fillStyle=this.shadowStyle.color,t.beginPath(),t.arc(this.w2,this.h2,this.outerCircle,0,TWOPI),t.arc(this.w2,this.h2,this.innerCircle,TWOPI,0,!0),t.fill());for(let i=0;i<this.buttons.length;i++){const e=this.buttons[i];this.buttonGap?setContextShadowStyle(t,this.shadowStyle):setContextShadowStyle(t,NO_SHADOW),this.hoverBackgroundColor&&this.state.hover===e?t.fillStyle=this.hoverBackgroundColor:t.fillStyle="backgroundColor"in e?e.backgroundColor:this.backgroundColor,t.strokeStyle="borderColor"in e?e.borderColor:this.borderColor,t.beginPath(),t.arc(this.w2,this.h2,this.outerCircle,e.ini,e.fin),t.arc(this.w2,this.h2,this.innerCircle,e.fin_inner,e.ini_inner,!0),t.closePath(),t.fill(),this.buttonGap&&setContextShadowStyle(t,NO_SHADOW),t.stroke(),setContextShadowStyle(t,{color:"textShadowColor"in e?e.textShadowColor:this.textShadowColor,blur:"textShadowBlur"in e?e.textShadowBlur:this.textShadowBlur,offsetX:"textShadowOffsetX"in e?e.textShadowOffsetX:this.textShadowOffsetX,offsetY:"textShadowOffsetY"in e?e.textShadowOffsetY:this.textShadowOffsetY}),this.hoverTextColor&&this.state.hover===e?t.fillStyle=this.hoverTextColor:t.fillStyle="textColor"in e?e.textColor:this.textColor,t.strokeStyle="textBorderColor"in e?e.textBorderColor:this.textBorderColor,t.save(),t.translate(this.w2,this.h2),t.fillText(e.text,e.centerX,e.centerY),t.strokeText(e.text,e.centerX,e.centerY),t.restore()}}addEvent(){if(this.canvas.addEventListener("click",t=>{let i=this.getButton(t.clientX,t.clientY);i&&i.action()}),(this.hoverBackgroundColor||this.hoverTextColor||this.hoverAction)&&this.canvas.addEventListener("mousemove",t=>{const i=this.state.hover;this.state.hover=this.getButton(t.clientX,t.clientY),i!==this.state.hover&&(this.hoverAction(void 0!==this.state.hover),this.draw())}),this.isFixed)return this.setPos(this.posX,this.posY),void this.show();document.addEventListener("click",t=>{this.hide()}),document.oncontextmenu=(t=>{t.preventDefault(),this.setPos(t.clientX-this.w2,t.clientY-this.h2),this.show()}),!!navigator.platform&&/iPad|iPhone|iPod/.test(navigator.platform)&&(document.addEventListener("touchstart",t=>{this.timer=setTimeout(()=>{this.setPos(t.touches[0].clientX-this.w2,t.touches[0].clientY-this.h2),this.show()},500)}),document.addEventListener("touchend",()=>{this.timer&&clearTimeout(this.timer)}))}distance(t,i,e,s){return Math.sqrt((e-t)**2+(s-i)**2)}hide(){this.canvas.style.display="none"}show(){this.draw(),this.canvas.style.display="block"}setPos(t,i){if(isNaN(t)||isNaN(i))throw"X and Y must be numbers";this.canvas.style.left=t+"px",this.canvas.style.top=i+"px"}createGradient(t){if(!("gradient"in t))throw"Invalid gradient object";let i;switch(t.gradient){case"radial":i=this.c.createRadialGradient(this.w2,this.h2,this.innerCircle,this.w2,this.h2,this.outerCircle);break;case"linear1":i=this.c.createLinearGradient(0,0,0,this.canvas.height);break;case"linear2":i=this.c.createLinearGradient(0,0,this.canvas.width,0);break;case"linear3":i=this.c.createLinearGradient(0,0,this.canvas.width,this.canvas.height);break;case"linear4":i=this.c.createLinearGradient(0,this.canvas.height,this.canvas.width,0);break;default:throw"Invalid gradient value"}for(const e in t.colors){if(isNaN(e)||e<0||e>1)throw"Invalid color position";i.addColorStop(e,t.colors[e])}return i}checkButtons(){if(!(this.buttons instanceof Array))throw"Buttons must be an Array of button objects";for(let t=0;t<this.buttons.length;t++){const i=this.buttons[t];if(!("text"in i&&"action"in i))throw"Button must have a text and an action value"}}addButtons(t){this.buttons=t,this.checkButtons(),this.init()}getButton(t,i){const e=this.canvas.getBoundingClientRect(),s=this.w/e.width,o=this.h/e.height,h=(e.left+this.w2)*s,r=(e.top+this.h2)*o,n=this.distance(t,i,h,r);let a;if(n>this.innerCircle&&n<this.outerCircle){let e=Math.atan2(i-r,t-h);e=e>0?e:TWOPI+e;for(let t=0;t<this.buttons.length;t++)if(e>=this.buttons[t].ini&&e<=this.buttons[t].fin){a=this.buttons[t];break}!a&&this.rest&&(e<this.buttons[this.rest].ini&&(e+=TWOPI),e>=this.buttons[this.rest].ini&&e<=this.buttons[this.rest].fin+TWOPI&&(a=this.buttons[this.rest]))}return a}};function setContextShadowStyle(t,i){t.shadowColor=i.color,t.shadowBlur=i.blur,t.shadowOffsetX=i.offsetX,t.shadowOffsetY=i.offsetY}